[
  {
    "question": "반도체 ETF 3개의 가격 추이를 비교해줘",
    "code": "# 1. 반도체 태그 ETF 목록 조회\nresults = graph_query(cypher=\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {name: '반도체'}) RETURN {code: e.code, name: e.name, expense_ratio: e.expense_ratio} ORDER BY e.net_assets DESC LIMIT 3\")\netfs = json.loads(results)\n\n# 2. 각 ETF의 가격 추이 조회\nprice_data = []\nfor etf in etfs:\n    prices = get_etf_prices(etf_code=etf['code'], period='1m')\n    price_info = json.loads(prices)\n    price_data.append({'name': etf['name'], 'code': etf['code'], 'summary': price_info['summary']})\n\n# 3. 표로 정리\nlines = ['| ETF | 코드 | 시작가 | 최종가 | 등락률 |', '|---|---|---|---|---|']\nfor p in price_data:\n    s = p['summary']\n    lines.append(f\"| {p['name']} | {p['code']} | {s['start_close']} | {s['end_close']} | {s['change_rate']}% |\")\nfinal_answer('\\n'.join(lines))",
    "description": "태그 검색 → 상위 N개 ETF 추출 → for 루프로 가격 조회 → 표 정리"
  },
  {
    "question": "삼성전자를 보유한 ETF 중 보수율이 낮은 3개의 상세 정보를 알려줘",
    "code": "# 1. 삼성전자 종목코드 확인\nsearch = stock_search(query='삼성전자')\nstocks = json.loads(search)\nstock_code = stocks[0]['code']\n\n# 2. 삼성전자를 보유한 ETF를 보수율순으로 조회\nresults = graph_query(cypher=f\"MATCH (e:ETF)-[h:HOLDS]->(s:Stock {{code: '{stock_code}'}}) WITH e, h ORDER BY h.date DESC WITH e, head(collect(h)) as latest RETURN {{code: e.code, name: e.name, weight: latest.weight, expense_ratio: e.expense_ratio}} ORDER BY e.expense_ratio ASC LIMIT 3\")\netfs = json.loads(results)\n\n# 3. 각 ETF의 상세 정보 조회\ndetails = []\nfor etf in etfs:\n    info = get_etf_info(etf_code=etf['code'])\n    details.append(json.loads(info))\n\n# 4. 표로 정리\nlines = ['| ETF | 코드 | 보수율 | 보유비중 | 태그 |', '|---|---|---|---|---|']\nfor d, e in zip(details, etfs):\n    tags = ', '.join(d.get('tags', []))\n    lines.append(f\"| {d['name']} | {d['code']} | {d.get('expense_ratio', 'N/A')} | {e['weight']}% | {tags} |\")\nfinal_answer('\\n'.join(lines))",
    "description": "종목 검색 → graph_query로 보유 ETF 필터 → for 루프 상세 조회 → 표 정리"
  },
  {
    "question": "AI 관련 ETF들의 보유종목 변동을 한번에 확인해줘",
    "code": "# 1. AI 태그 ETF 목록 조회\nresults = graph_query(cypher=\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {name: 'AI'}) RETURN {code: e.code, name: e.name} ORDER BY e.net_assets DESC LIMIT 5\")\netfs = json.loads(results)\n\n# 2. 각 ETF의 보유종목 변동 조회\nall_changes = []\nfor etf in etfs:\n    changes = get_holdings_changes(etf_code=etf['code'], period='1w')\n    if changes != '변동 없음':\n        all_changes.append({'name': etf['name'], 'code': etf['code'], 'changes': json.loads(changes)})\n\n# 3. 결과 정리\nif not all_changes:\n    final_answer('최근 1주간 AI ETF들의 보유종목 변동이 없습니다.')\nelse:\n    lines = ['| ETF | 종목 | 변동유형 | 이전비중 | 현재비중 |', '|---|---|---|---|---|']\n    for etf_change in all_changes:\n        for c in etf_change['changes'][:5]:\n            lines.append(f\"| {etf_change['name']} | {c.get('stock_name', '')} | {c['change_type']} | {c.get('before_weight', '-')} | {c.get('after_weight', '-')} |\")\n    final_answer('\\n'.join(lines))",
    "description": "태그 ETF 조회 → for 루프 보유종목 변동 조회 → 빈 결과 분기 처리"
  },
  {
    "question": "KODEX 200과 유사한 ETF 5개의 상세 정보를 비교해줘",
    "code": "# 1. KODEX 200 코드 확인\nsearch = etf_search(query='KODEX 200')\nresult = json.loads(search)\netf_code = result[0]['code']\n\n# 2. 유사 ETF 조회\nsimilar = find_similar_etfs(etf_code=etf_code)\nsimilar_etfs = json.loads(similar)\n\n# 3. 상위 5개 유사 ETF 상세 조회\ndetails = []\nfor etf in similar_etfs[:5]:\n    info = get_etf_info(etf_code=etf['etf_code'])\n    detail = json.loads(info)\n    detail['similarity'] = etf.get('similarity', '')\n    details.append(detail)\n\n# 4. 표로 정리\nlines = ['| ETF | 코드 | 보수율 | 유사도 | 태그 |', '|---|---|---|---|---|']\nfor d in details:\n    tags = ', '.join(d.get('tags', []))\n    lines.append(f\"| {d['name']} | {d['code']} | {d.get('expense_ratio', 'N/A')} | {d.get('similarity', '')} | {tags} |\")\nfinal_answer('\\n'.join(lines))",
    "description": "ETF 검색 → 유사 ETF 조회 → for 루프 상세 조회 → 표 정리"
  },
  {
    "question": "2차전지 ETF 중 보수율 낮은 3개와 높은 3개를 비교해줘",
    "code": "# 1. 2차전지 태그 ETF를 보수율순으로 조회\nresults = graph_query(cypher=\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {name: '2차전지'}) RETURN {code: e.code, name: e.name, expense_ratio: e.expense_ratio} ORDER BY e.expense_ratio ASC\")\netfs = json.loads(results)\n\n# 2. 보수율 낮은 3개 + 높은 3개 추출\nlow3 = etfs[:3]\nhigh3 = etfs[-3:] if len(etfs) >= 6 else etfs[3:]\n\n# 3. 각 ETF 상세 정보 조회\nall_details = []\nfor etf in low3 + high3:\n    info = get_etf_info(etf_code=etf['code'])\n    detail = json.loads(info)\n    detail['group'] = '저보수' if etf in low3 else '고보수'\n    all_details.append(detail)\n\n# 4. 표로 정리\nlines = ['| 구분 | ETF | 보수율 | 1개월 수익률 | 태그 |', '|---|---|---|---|---|']\nfor d in all_details:\n    returns = d.get('returns', {})\n    ret_1m = f\"{returns.get('1m', 'N/A')}%\" if '1m' in returns else 'N/A'\n    lines.append(f\"| {d['group']} | {d['name']} | {d.get('expense_ratio', 'N/A')} | {ret_1m} | {', '.join(d.get('tags', []))} |\")\nfinal_answer('\\n'.join(lines))",
    "description": "태그 ETF 전체 조회 → 정렬로 상/하위 추출 → for 루프 상세 조회"
  },
  {
    "question": "SK하이닉스를 보유한 ETF 중 수익률이 좋은 3개의 가격 추이를 보여줘",
    "code": "# 1. SK하이닉스 종목코드 확인\nsearch = stock_search(query='SK하이닉스')\nstocks = json.loads(search)\nstock_code = stocks[0]['code']\n\n# 2. SK하이닉스를 보유한 ETF를 수익률순으로 조회\nresults = graph_query(cypher=f\"MATCH (e:ETF)-[h:HOLDS]->(s:Stock {{code: '{stock_code}'}}) WITH e, h ORDER BY h.date DESC WITH e, head(collect(h)) as latest RETURN {{code: e.code, name: e.name, weight: latest.weight, return_1m: e.return_1m}} ORDER BY e.return_1m DESC LIMIT 3\")\netfs = json.loads(results)\n\n# 3. 각 ETF 가격 추이 조회\nprice_data = []\nfor etf in etfs:\n    prices = get_etf_prices(etf_code=etf['code'], period='1m')\n    price_info = json.loads(prices)\n    price_data.append({'name': etf['name'], 'code': etf['code'], 'summary': price_info['summary']})\n\n# 4. 표로 정리\nlines = ['| ETF | 코드 | 시작가 | 최종가 | 등락률 | 평균거래량 |', '|---|---|---|---|---|---|']\nfor p in price_data:\n    s = p['summary']\n    lines.append(f\"| {p['name']} | {p['code']} | {s['start_close']} | {s['end_close']} | {s['change_rate']}% | {s.get('avg_volume', 'N/A')} |\")\nfinal_answer('\\n'.join(lines))",
    "description": "종목 검색 → graph_query 수익률순 필터 → for 루프 가격 조회"
  },
  {
    "question": "배당 ETF와 반도체 ETF를 하나씩 추천하고 비교해줘",
    "code": "# 1. 배당 태그 ETF 중 순자산 최대\nresult1 = graph_query(cypher=\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {name: '배당'}) RETURN {code: e.code, name: e.name} ORDER BY e.net_assets DESC LIMIT 1\")\ndiv_etf = json.loads(result1)[0]\n\n# 2. 반도체 태그 ETF 중 순자산 최대\nresult2 = graph_query(cypher=\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {name: '반도체'}) RETURN {code: e.code, name: e.name} ORDER BY e.net_assets DESC LIMIT 1\")\nchip_etf = json.loads(result2)[0]\n\n# 3. 두 ETF 비교\ncomparison = compare_etfs(etf_codes=f\"{div_etf['code']},{chip_etf['code']}\")\ncomp_data = json.loads(comparison)\n\n# 4. 표로 정리\nlines = ['| 항목 | ' + comp_data[0]['name'] + ' | ' + comp_data[1]['name'] + ' |', '|---|---|---|']\nfor key in ['code', 'expense_ratio', 'return_1m', 'latest_net_assets']:\n    label = {'code': '코드', 'expense_ratio': '보수율', 'return_1m': '1개월 수익률', 'latest_net_assets': '순자산'}[key]\n    lines.append(f\"| {label} | {comp_data[0].get(key, 'N/A')} | {comp_data[1].get(key, 'N/A')} |\")\nfinal_answer('\\n'.join(lines))",
    "description": "두 태그에서 대표 ETF 추출 → compare_etfs로 비교"
  },
  {
    "question": "삼성자산운용의 ETF 중 수익률 상위 5개의 보유종목을 알려줘",
    "code": "# 1. 삼성자산운용 ETF를 수익률순으로 조회\nresults = graph_query(cypher=\"MATCH (e:ETF)-[:MANAGED_BY]->(c:Company {name: '삼성자산운용'}) RETURN {code: e.code, name: e.name, return_1m: e.return_1m} ORDER BY e.return_1m DESC LIMIT 5\")\netfs = json.loads(results)\n\n# 2. 각 ETF의 상세 정보 조회 (보유종목 포함)\nall_info = []\nfor etf in etfs:\n    info = get_etf_info(etf_code=etf['code'])\n    all_info.append(json.loads(info))\n\n# 3. 각 ETF별 상위 보유종목 표 생성\nlines = []\nfor info in all_info:\n    lines.append(f\"\\n### {info['name']} ({info['code']})\")\n    lines.append('| 종목 | 비중(%) |')\n    lines.append('|---|---|')\n    for h in info.get('top_holdings', [])[:5]:\n        lines.append(f\"| {h['stock_name']} | {h['weight']} |\")\nfinal_answer('\\n'.join(lines))",
    "description": "운용사별 ETF 조회 → for 루프 상세 조회 → 섹션별 표 생성"
  },
  {
    "question": "TIGER ETF 중에서 보수율이 0.1% 이하인 ETF의 가격 추이를 보여줘",
    "code": "# 1. TIGER ETF 검색\nsearch = etf_search(query='TIGER', limit=50)\netfs = json.loads(search)\n\n# 2. 보수율 0.1% 이하 필터링 (expense_ratio가 '0.10%' 형식 문자열)\nlow_fee = [e for e in etfs if e.get('expense_ratio') and float(e['expense_ratio'].replace('%', '')) <= 0.1]\n\nif not low_fee:\n    final_answer('보수율 0.1% 이하인 TIGER ETF가 없습니다.')\nelse:\n    # 3. 각 ETF 가격 조회 (최대 5개)\n    lines = ['| ETF | 코드 | 보수율 | 시작가 | 최종가 | 등락률 |', '|---|---|---|---|---|---|']\n    for etf in low_fee[:5]:\n        prices = get_etf_prices(etf_code=etf['code'], period='1m')\n        price_info = json.loads(prices)\n        s = price_info['summary']\n        lines.append(f\"| {etf['name']} | {etf['code']} | {etf['expense_ratio']} | {s['start_close']} | {s['end_close']} | {s['change_rate']}% |\")\n    final_answer('\\n'.join(lines))",
    "description": "ETF 검색 → 리스트 필터링 → for 루프 가격 조회 → 빈 결과 분기"
  },
  {
    "question": "코스피 200 추종 ETF들의 보수율과 수익률을 비교해줘",
    "code": "# 1. 코스피 태그 ETF 조회\nresults = graph_query(cypher=\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {name: '코스피'}) RETURN {code: e.code, name: e.name, expense_ratio: e.expense_ratio} ORDER BY e.net_assets DESC LIMIT 10\")\netfs = json.loads(results)\n\n# 2. 상위 3개 ETF 비교\ncodes = ','.join([e['code'] for e in etfs[:3]])\ncomparison = compare_etfs(etf_codes=codes)\ncomp_data = json.loads(comparison)\n\n# 3. 표로 정리\nlines = ['| ETF | 코드 | 보수율 | 1개월 수익률 | 순자산 |', '|---|---|---|---|---|']\nfor c in comp_data:\n    lines.append(f\"| {c['name']} | {c['code']} | {c.get('expense_ratio', 'N/A')} | {c.get('return_1m', 'N/A')}% | {c.get('latest_net_assets', 'N/A')} |\")\nfinal_answer('\\n'.join(lines))",
    "description": "태그 ETF 조회 → 상위 N개 코드 추출 → compare_etfs 비교"
  },
  {
    "question": "삼성전자와 SK하이닉스를 동시에 보유한 ETF 중 보수율이 가장 낮은 3개 상세 정보",
    "code": "# 1. 종목코드 확인\nsearch1 = stock_search(query='삼성전자')\ncode1 = json.loads(search1)[0]['code']\nsearch2 = stock_search(query='SK하이닉스')\ncode2 = json.loads(search2)[0]['code']\n\n# 2. 두 종목을 동시에 보유한 ETF 조회\nresults = graph_query(cypher=f\"MATCH (e:ETF)-[h1:HOLDS]->(s1:Stock {{code: '{code1}'}}) WITH e, h1 ORDER BY h1.date DESC WITH e, head(collect(h1)) as lh1 MATCH (e)-[h2:HOLDS]->(s2:Stock {{code: '{code2}'}}) WITH e, lh1, h2 ORDER BY h2.date DESC WITH e, lh1, head(collect(h2)) as lh2 RETURN {{code: e.code, name: e.name, weight1: lh1.weight, weight2: lh2.weight, expense_ratio: e.expense_ratio}} ORDER BY e.expense_ratio ASC LIMIT 3\")\netfs = json.loads(results)\n\n# 3. 상세 정보 조회\ndetails = []\nfor etf in etfs:\n    info = get_etf_info(etf_code=etf['code'])\n    detail = json.loads(info)\n    detail['weight_samsung'] = etf['weight1']\n    detail['weight_hynix'] = etf['weight2']\n    details.append(detail)\n\n# 4. 표로 정리\nlines = ['| ETF | 보수율 | 삼성전자 비중 | SK하이닉스 비중 | 태그 |', '|---|---|---|---|---|']\nfor d in details:\n    tags = ', '.join(d.get('tags', []))\n    lines.append(f\"| {d['name']} | {d.get('expense_ratio', 'N/A')} | {d['weight_samsung']}% | {d['weight_hynix']}% | {tags} |\")\nfinal_answer('\\n'.join(lines))",
    "description": "복수 종목 검색 → 동시 보유 ETF Cypher → for 루프 상세 조회"
  },
  {
    "question": "바이오 ETF와 헬스케어 ETF 중 각각 수익률 1등을 비교해줘",
    "code": "# 1. 바이오 태그 수익률 1등\nresult1 = graph_query(cypher=\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {name: '바이오'}) RETURN {code: e.code, name: e.name, return_1m: e.return_1m} ORDER BY e.return_1m DESC LIMIT 1\")\nbio = json.loads(result1)\n\n# 2. 헬스케어 태그 수익률 1등\nresult2 = graph_query(cypher=\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {name: '헬스케어'}) RETURN {code: e.code, name: e.name, return_1m: e.return_1m} ORDER BY e.return_1m DESC LIMIT 1\")\nhc = json.loads(result2)\n\nif not bio or not hc:\n    final_answer('바이오 또는 헬스케어 태그의 ETF를 찾을 수 없습니다.')\nelse:\n    # 3. 두 ETF 비교\n    codes = f\"{bio[0]['code']},{hc[0]['code']}\"\n    comparison = compare_etfs(etf_codes=codes)\n    comp_data = json.loads(comparison)\n\n    lines = ['| 항목 | ' + comp_data[0]['name'] + ' | ' + comp_data[1]['name'] + ' |', '|---|---|---|']\n    for key in ['code', 'expense_ratio', 'return_1m', 'latest_net_assets']:\n        label = {'code': '코드', 'expense_ratio': '보수율', 'return_1m': '1개월 수익률', 'latest_net_assets': '순자산'}[key]\n        lines.append(f\"| {label} | {comp_data[0].get(key, 'N/A')} | {comp_data[1].get(key, 'N/A')} |\")\n    final_answer('\\n'.join(lines))",
    "description": "두 태그 각각 수익률 1등 추출 → compare_etfs 비교 → 빈 결과 분기"
  },
  {
    "question": "순자산 상위 5개 ETF의 최근 1주 가격과 보유종목 변동을 알려줘",
    "code": "# 1. 순자산 상위 5개 ETF\nresults = graph_query(cypher=\"MATCH (e:ETF) RETURN {code: e.code, name: e.name, net_assets: e.net_assets} ORDER BY e.net_assets DESC LIMIT 5\")\netfs = json.loads(results)\n\n# 2. 각 ETF의 가격과 보유종목 변동 조회\nlines = []\nfor etf in etfs:\n    # 가격 조회\n    prices = get_etf_prices(etf_code=etf['code'], period='1w')\n    price_info = json.loads(prices)\n    s = price_info['summary']\n\n    # 보유종목 변동 조회\n    changes = get_holdings_changes(etf_code=etf['code'], period='1w')\n    change_count = 0 if changes == '변동 없음' else len(json.loads(changes))\n\n    lines.append(f\"| {etf['name']} | {etf['code']} | {s['start_close']} | {s['end_close']} | {s['change_rate']}% | {change_count}건 |\")\n\nheader = '| ETF | 코드 | 주초가 | 주말가 | 등락률 | 보유종목변동 |\\n|---|---|---|---|---|---|\\n'\nfinal_answer(header + '\\n'.join(lines))",
    "description": "순자산 상위 ETF 조회 → for 루프 가격+변동 병렬 조회"
  },
  {
    "question": "방산 ETF 전체의 상세 정보와 가격을 알려줘",
    "code": "# 1. 방산 태그 ETF 조회\nresults = graph_query(cypher=\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {name: '방산'}) RETURN {code: e.code, name: e.name} ORDER BY e.net_assets DESC\")\netfs = json.loads(results)\n\nif not etfs:\n    final_answer('방산 태그의 ETF가 없습니다.')\nelse:\n    # 2. 각 ETF 상세+가격 조회\n    lines = []\n    for etf in etfs:\n        info = json.loads(get_etf_info(etf_code=etf['code']))\n        prices = json.loads(get_etf_prices(etf_code=etf['code'], period='1m'))\n        s = prices['summary']\n        returns = info.get('returns', {})\n        lines.append(f\"| {info['name']} | {info['code']} | {info.get('expense_ratio', 'N/A')} | {returns.get('1m', 'N/A')}% | {s['change_rate']}% | {s.get('avg_volume', 'N/A')} |\")\n\n    header = '| ETF | 코드 | 보수율 | 1개월수익률 | 가격등락률 | 평균거래량 |\\n|---|---|---|---|---|---|\\n'\n    final_answer(header + '\\n'.join(lines))",
    "description": "태그 ETF 전체 조회 → for 루프 상세+가격 조회 → 빈 결과 분기"
  },
  {
    "question": "KODEX ETF 중 가장 인기 있는 5개와 가장 인기 없는 5개를 비교해줘",
    "code": "# 1. KODEX ETF 전체 조회 (순자산순)\nsearch = etf_search(query='KODEX', limit=50)\netfs = json.loads(search)\n\n# 2. 각 ETF의 상세 조회 (순자산 확인)\ndetailed = []\nfor etf in etfs:\n    info = json.loads(get_etf_info(etf_code=etf['code']))\n    detailed.append(info)\n\n# 3. 순자산 기준 정렬\n# 순자산이 없는 경우 제외\nwith_assets = [d for d in detailed if d.get('returns')]\ntop5 = detailed[:5]\nbottom5 = detailed[-5:] if len(detailed) >= 10 else detailed[5:]\n\n# 4. 표로 정리\nlines = ['## 순자산 상위 5개', '| ETF | 보수율 | 태그 |', '|---|---|---|']\nfor d in top5:\n    lines.append(f\"| {d['name']} | {d.get('expense_ratio', 'N/A')} | {', '.join(d.get('tags', []))} |\")\nlines.extend(['', '## 순자산 하위 5개', '| ETF | 보수율 | 태그 |', '|---|---|---|'])\nfor d in bottom5:\n    lines.append(f\"| {d['name']} | {d.get('expense_ratio', 'N/A')} | {', '.join(d.get('tags', []))} |\")\nfinal_answer('\\n'.join(lines))",
    "description": "ETF 검색 → for 루프 상세 조회 → 상/하위 분리 → 섹션별 표"
  },
  {
    "question": "금융 ETF 3개의 보유종목 상위 5개를 한눈에 비교해줘",
    "code": "# 1. 금융 태그 ETF 상위 3개 조회\nresults = graph_query(cypher=\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {name: '금융'}) RETURN {code: e.code, name: e.name} ORDER BY e.net_assets DESC LIMIT 3\")\netfs = json.loads(results)\n\n# 2. 각 ETF의 상세 정보 조회\nlines = []\nfor etf in etfs:\n    info = json.loads(get_etf_info(etf_code=etf['code']))\n    lines.append(f\"\\n### {info['name']} (보수율: {info.get('expense_ratio', 'N/A')})\")\n    lines.append('| 순위 | 종목 | 비중(%) |')\n    lines.append('|---|---|---|')\n    for i, h in enumerate(info.get('top_holdings', [])[:5], 1):\n        lines.append(f\"| {i} | {h['stock_name']} | {h['weight']} |\")\n\nfinal_answer('\\n'.join(lines))",
    "description": "태그 ETF 조회 → for 루프 상세 조회 → 각 ETF별 보유종목 표"
  },
  {
    "question": "삼성전자를 10% 이상 보유한 ETF들의 최근 수익률을 비교해줘",
    "code": "# 1. 삼성전자 코드 확인\nsearch = stock_search(query='삼성전자')\nstock_code = json.loads(search)[0]['code']\n\n# 2. 삼성전자를 10% 이상 보유한 ETF 조회\nresults = graph_query(cypher=f\"MATCH (e:ETF)-[h:HOLDS]->(s:Stock {{code: '{stock_code}'}}) WITH e, h ORDER BY h.date DESC WITH e, head(collect(h)) as latest WHERE latest.weight >= 10.0 RETURN {{code: e.code, name: e.name, weight: latest.weight, expense_ratio: e.expense_ratio}} ORDER BY latest.weight DESC\")\netfs = json.loads(results)\n\n# 3. 각 ETF 가격 조회\nlines = ['| ETF | 보유비중 | 보수율 | 1개월 등락률 |', '|---|---|---|---|']\nfor etf in etfs:\n    prices = json.loads(get_etf_prices(etf_code=etf['code'], period='1m'))\n    s = prices['summary']\n    lines.append(f\"| {etf['name']} | {etf['weight']}% | {etf.get('expense_ratio', 'N/A')} | {s['change_rate']}% |\")\n\nfinal_answer('\\n'.join(lines))",
    "description": "종목 검색 → 비중 조건 Cypher → for 루프 가격 조회"
  },
  {
    "question": "미래에셋자산운용과 삼성자산운용의 반도체 ETF를 비교해줘",
    "code": "# 1. 미래에셋 반도체 ETF\nresult1 = graph_query(cypher=\"MATCH (e:ETF)-[:MANAGED_BY]->(c:Company {name: '미래에셋자산운용'}) MATCH (e)-[:TAGGED]->(t:Tag {name: '반도체'}) RETURN {code: e.code, name: e.name, expense_ratio: e.expense_ratio} ORDER BY e.net_assets DESC\")\nmirae = json.loads(result1)\n\n# 2. 삼성 반도체 ETF\nresult2 = graph_query(cypher=\"MATCH (e:ETF)-[:MANAGED_BY]->(c:Company {name: '삼성자산운용'}) MATCH (e)-[:TAGGED]->(t:Tag {name: '반도체'}) RETURN {code: e.code, name: e.name, expense_ratio: e.expense_ratio} ORDER BY e.net_assets DESC\")\nsamsung = json.loads(result2)\n\n# 3. 각각 상위 2개씩 상세 조회\nlines = ['## 미래에셋 반도체 ETF', '| ETF | 보수율 | 1개월수익률 |', '|---|---|---|']\nfor etf in mirae[:2]:\n    info = json.loads(get_etf_info(etf_code=etf['code']))\n    ret = info.get('returns', {}).get('1m', 'N/A')\n    lines.append(f\"| {info['name']} | {info.get('expense_ratio', 'N/A')} | {ret}% |\")\n\nlines.extend(['', '## 삼성 반도체 ETF', '| ETF | 보수율 | 1개월수익률 |', '|---|---|---|'])\nfor etf in samsung[:2]:\n    info = json.loads(get_etf_info(etf_code=etf['code']))\n    ret = info.get('returns', {}).get('1m', 'N/A')\n    lines.append(f\"| {info['name']} | {info.get('expense_ratio', 'N/A')} | {ret}% |\")\n\nfinal_answer('\\n'.join(lines))",
    "description": "두 운용사×태그 교차 조회 → 각각 상세 조회 → 섹션별 비교"
  },
  {
    "question": "최근 1주 수익률 상위 3개 ETF의 보유종목과 유사 ETF를 알려줘",
    "code": "# 1. 1주 수익률 상위 3개 ETF\nresults = graph_query(cypher=\"MATCH (e:ETF) RETURN {code: e.code, name: e.name, return_1w: e.return_1w} ORDER BY e.return_1w DESC LIMIT 3\")\ntop_etfs = json.loads(results)\n\nlines = []\nfor etf in top_etfs:\n    # 2. 상세 정보 (보유종목)\n    info = json.loads(get_etf_info(etf_code=etf['code']))\n    lines.append(f\"\\n### {info['name']} (1주 수익률: {etf.get('return_1w', 'N/A')}%)\")\n    lines.append('\\n**상위 보유종목:**')\n    lines.append('| 종목 | 비중 |')\n    lines.append('|---|---|')\n    for h in info.get('top_holdings', [])[:5]:\n        lines.append(f\"| {h['stock_name']} | {h['weight']}% |\")\n\n    # 3. 유사 ETF\n    similar = json.loads(find_similar_etfs(etf_code=etf['code']))\n    lines.append('\\n**유사 ETF:**')\n    lines.append('| ETF | 유사도 |')\n    lines.append('|---|---|')\n    for s in similar[:3]:\n        lines.append(f\"| {s['name']} | {s.get('similarity', '')} |\")\n\nfinal_answer('\\n'.join(lines))",
    "description": "수익률 상위 ETF 조회 → for 루프 (상세 + 유사 ETF) → 섹션별 표"
  },
  {
    "question": "삼성전자 주가와 삼성전자를 가장 많이 보유한 ETF 3개의 가격을 비교해줘",
    "code": "# 1. 삼성전자 코드 확인\nsearch = stock_search(query='삼성전자')\nstock_code = json.loads(search)[0]['code']\n\n# 2. 삼성전자 주가 조회\nstock_prices = json.loads(get_stock_prices(stock_code=stock_code, period='1m'))\n\n# 3. 삼성전자를 가장 많이 보유한 ETF 3개\nresults = graph_query(cypher=f\"MATCH (e:ETF)-[h:HOLDS]->(s:Stock {{code: '{stock_code}'}}) WITH e, h ORDER BY h.date DESC WITH e, head(collect(h)) as latest RETURN {{code: e.code, name: e.name, weight: latest.weight}} ORDER BY latest.weight DESC LIMIT 3\")\netfs = json.loads(results)\n\n# 4. 각 ETF 가격 조회\nlines = ['| 종목/ETF | 시작가 | 최종가 | 등락률 |', '|---|---|---|---|']\nss = stock_prices['summary']\nlines.append(f\"| 삼성전자 | {ss['start_close']} | {ss['end_close']} | {ss['change_rate']}% |\")\n\nfor etf in etfs:\n    ep = json.loads(get_etf_prices(etf_code=etf['code'], period='1m'))\n    es = ep['summary']\n    lines.append(f\"| {etf['name']} ({etf['weight']}%) | {es['start_close']} | {es['end_close']} | {es['change_rate']}% |\")\n\nfinal_answer('\\n'.join(lines))",
    "description": "종목 검색 → 주가 조회 + 보유 ETF 조회 → for 루프 ETF 가격 → 통합 비교표"
  },
  {
    "question": "내 즐겨찾기 ETF의 수익률과 가격 추이를 알려줘",
    "code": "# 1. 즐겨찾기 ETF 목록 조회 ($user_id는 시스템이 자동 주입)\nresults = graph_query(cypher=\"MATCH (u:User {user_id: $user_id})-[w:WATCHES]->(e:ETF) RETURN {code: e.code, name: e.name, return_1d: e.return_1d, return_1w: e.return_1w, return_1m: e.return_1m} ORDER BY w.added_at DESC\")\nif results == '조회 결과 없음':\n    final_answer('즐겨찾기한 ETF가 없습니다.')\nelse:\n    etfs = json.loads(results)\n\n    # 2. 각 ETF 가격 추이 조회\n    lines = ['| ETF | 코드 | 일간 | 주간 | 월간 | 최근종가 | 등락률 |', '|---|---|---|---|---|---|---|']\n    for etf in etfs:\n        prices = json.loads(get_etf_prices(etf_code=etf['code'], period='1m'))\n        s = prices['summary']\n        lines.append(f\"| {etf['name']} | {etf['code']} | {etf.get('return_1d', 'N/A')}% | {etf.get('return_1w', 'N/A')}% | {etf.get('return_1m', 'N/A')}% | {s['end_close']} | {s['change_rate']}% |\")\n    final_answer('\\n'.join(lines))",
    "description": "즐겨찾기 ETF graph_query ($user_id 패턴) → for 루프 가격 조회"
  },
  {
    "question": "KODEX 200과 TIGER 200의 공통 보유종목 비중을 비교해줘",
    "code": "# 1. 두 ETF 코드 확인\nsearch1 = etf_search(query='KODEX 200')\ncode1 = json.loads(search1)[0]['code']\nsearch2 = etf_search(query='TIGER 200')\ncode2 = json.loads(search2)[0]['code']\n\n# 2. 공통 보유종목과 각 비중 조회 (Cypher로 JOIN)\nresults = graph_query(cypher=f\"MATCH (e1:ETF {{code: '{code1}'}})-[h1:HOLDS]->(s:Stock) WITH s, h1 ORDER BY h1.date DESC WITH s, head(collect(h1)) as lh1 MATCH (s)<-[h2:HOLDS]-(e2:ETF {{code: '{code2}'}}) WITH s, lh1, h2 ORDER BY h2.date DESC WITH s, lh1, head(collect(h2)) as lh2 RETURN {{stock_name: s.name, weight_etf1: lh1.weight, weight_etf2: lh2.weight}} ORDER BY lh1.weight DESC\")\ncommon = json.loads(results)\n\n# 3. 표로 정리\nlines = ['| 종목 | KODEX 200 비중 | TIGER 200 비중 | 차이 |', '|---|---|---|---|']\nfor c in common[:15]:\n    diff = round(c['weight_etf1'] - c['weight_etf2'], 2)\n    lines.append(f\"| {c['stock_name']} | {c['weight_etf1']}% | {c['weight_etf2']}% | {diff}%p |\")\nfinal_answer('\\n'.join(lines))",
    "description": "두 ETF 검색 → Cypher JOIN으로 공통 보유종목 비중 비교"
  },
  {
    "question": "반도체 ETF들의 보수율 통계와 추천 ETF를 알려줘",
    "code": "# 1. 반도체 태그 보수율 통계 (집계 쿼리)\nstats = graph_query(cypher=\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {name: '반도체'}) WITH min(e.expense_ratio) as min_exp, max(e.expense_ratio) as max_exp, avg(e.expense_ratio) as avg_exp, count(e) as cnt RETURN {min_expense: min_exp, max_expense: max_exp, avg_expense: avg_exp, etf_count: cnt}\")\nstat = json.loads(stats)[0]\n\n# 2. 보수율 낮은 순 상위 3개 ETF 상세 조회\nresults = graph_query(cypher=\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {name: '반도체'}) RETURN {code: e.code, name: e.name, expense_ratio: e.expense_ratio} ORDER BY e.expense_ratio ASC LIMIT 3\")\ntop3 = json.loads(results)\n\ndetails = []\nfor etf in top3:\n    info = json.loads(get_etf_info(etf_code=etf['code']))\n    details.append(info)\n\n# 3. 통계 + 추천 표 정리\nlines = [f\"반도체 ETF {stat['etf_count']}개 통계: 평균 보수율 {stat['avg_expense']:.2f}%, 최저 {stat['min_expense']:.2f}%, 최고 {stat['max_expense']:.2f}%\\n\"]\nlines.append('### 보수율 낮은 추천 ETF')\nlines.append('| ETF | 보수율 | 1개월수익률 | 태그 |')\nlines.append('|---|---|---|---|')\nfor d in details:\n    ret = d.get('returns', {}).get('1m', 'N/A')\n    lines.append(f\"| {d['name']} | {d.get('expense_ratio', 'N/A')} | {ret}% | {', '.join(d.get('tags', []))} |\")\nfinal_answer('\\n'.join(lines))",
    "description": "Cypher 집계(min/max/avg) → 상위 ETF 상세 조회 → 통계+추천 표"
  },
  {
    "question": "최근 신규 편입된 종목이 있는 ETF를 알려주고 해당 ETF 상세도 보여줘",
    "code": "# 1. 신규 편입 변동이 있는 ETF 조회 (HAS_CHANGE 관계)\nresults = graph_query(cypher=\"MATCH (e:ETF)-[:HAS_CHANGE]->(c:Change {change_type: 'new'}) RETURN {etf_code: e.code, etf_name: e.name, stock_name: c.stock_name, weight: c.after_weight, detected_at: c.detected_at} ORDER BY c.detected_at DESC LIMIT 10\")\n\nif results == '조회 결과 없음':\n    final_answer('최근 신규 편입된 종목 변동이 없습니다.')\nelse:\n    changes = json.loads(results)\n    # 중복 ETF 제거하여 상위 5개 ETF만\n    seen = set()\n    unique_etfs = []\n    for c in changes:\n        if c['etf_code'] not in seen:\n            seen.add(c['etf_code'])\n            unique_etfs.append(c)\n        if len(unique_etfs) >= 5:\n            break\n\n    # 2. 각 ETF 상세 정보 조회\n    lines = ['| ETF | 신규편입종목 | 편입비중 | 보수율 | 태그 |', '|---|---|---|---|---|']\n    for etf in unique_etfs:\n        info = json.loads(get_etf_info(etf_code=etf['etf_code']))\n        tags = ', '.join(info.get('tags', []))\n        lines.append(f\"| {etf['etf_name']} | {etf['stock_name']} | {etf.get('weight', 'N/A')}% | {info.get('expense_ratio', 'N/A')} | {tags} |\")\n    final_answer('\\n'.join(lines))",
    "description": "HAS_CHANGE 관계로 변동 조회 → 중복 제거 → for 루프 상세 조회"
  },
  {
    "question": "삼성전자가 많이 포함된 테마(태그)는 뭐야? 각 태그별 대표 ETF도 알려줘",
    "code": "# 1. 삼성전자 코드 확인\nsearch = stock_search(query='삼성전자')\nstock_code = json.loads(search)[0]['code']\n\n# 2. 삼성전자를 보유한 ETF들의 태그 분포 조회\nresults = graph_query(cypher=f\"MATCH (e:ETF)-[h:HOLDS]->(s:Stock {{code: '{stock_code}'}}) MATCH (e)-[:TAGGED]->(t:Tag) WITH t.name as tag_name, count(DISTINCT e) as etf_count RETURN {{tag_name: tag_name, etf_count: etf_count}} ORDER BY etf_count DESC\")\ntag_dist = json.loads(results)\n\n# 3. 각 태그별 대표 ETF (순자산 최대) 조회\nlines = ['| 태그 | ETF수 | 대표 ETF | 보수율 |', '|---|---|---|---|']\nfor tag in tag_dist[:7]:\n    rep = graph_query(cypher=f\"MATCH (e:ETF)-[:TAGGED]->(t:Tag {{name: '{tag['tag_name']}'}}) RETURN {{code: e.code, name: e.name, expense_ratio: e.expense_ratio}} ORDER BY e.net_assets DESC LIMIT 1\")\n    rep_etf = json.loads(rep)[0]\n    lines.append(f\"| {tag['tag_name']} | {tag['etf_count']}개 | {rep_etf['name']} | {rep_etf.get('expense_ratio', 'N/A')} |\")\nfinal_answer('\\n'.join(lines))",
    "description": "종목 검색 → 태그 분포 집계 Cypher → for 루프 태그별 대표 ETF 조회"
  }
]
